## Problem Statement
```
    Design a health consultation app
    The user can login in the app
    The user can book an appointment for a doctor
    A doctor will be assigned after from a pool of doctors available.
    The assignment is at runtime, that is it is assigned right after an appointment is created
    Once a doctor is assigned. He cannot be assigned to anyone else till the appointment is closed/canceled
    The user and doctor can converse/meet using chat or video.
    The doctor can generate prescriptions.
    The doctor can close the appointment, or refer someone else, or appoint himself for a later date.
```

Designing a health consultation app involves creating an architecture that supports user management, appointment booking, real-time doctor assignment, communication, and prescription management. Below is a detailed design of the system, including core components, service layers, and a database schema.

## 1. Core Entities

1.User: Represents a patient or a doctor using the system.
2.Doctor: A specialized user who can be assigned to appointments, generate prescriptions, and manage appointments.
3.Appointment: Represents a scheduled consultation between a user and a doctor.
4.Prescription: Represents a document generated by a doctor containing medical advice or medication details.
5.Chat: Represents the communication channel between the user and the doctor.
6.VideoSession: Represents a video consultation between the user and the doctor.

## 2. Service Components

1.UserService: Manages user authentication, registration, and profile management.
2.DoctorService: Handles doctor availability, assignment to appointments, and management of appointments.
3.AppointmentService: Manages the booking of appointments, real-time doctor assignment, and appointment status.
4.CommunicationService: Facilitates chat and video sessions between users and doctors.
5.PrescriptionService: Manages the creation and storage of prescriptions.
6.NotificationService: Sends notifications for appointment confirmations, reminders, and updates.
7.AdminService: Manages the overall system, including user and doctor management, and generates reports.

## 3. Class Diagrams and Definitions

### 3.1. User
```java
public class User {
    private String userId;
    private String name;
    private String email;
    private String password;
    private String role; // "Patient" or "Doctor"
    private String phoneNumber;
    
    // Constructors, Getters, and Setters
}
```

**Explanation:** The User class stores information about users, which can be either patients or doctors, including their login credentials and contact information.

### 3.2. Doctor
```java
public class Doctor extends User {
    private String doctorId;
    private String specialization;
    private boolean isAvailable;
    
    // Constructors, Getters, and Setters
    
    public synchronized boolean assignToAppointment() {
        if (isAvailable) {
            isAvailable = false;
            return true;
        }
        return false;
    }
    
    public synchronized void releaseFromAppointment() {
        isAvailable = true;
    }
}
```

**Explanation:** The Doctor class extends User and adds specific attributes like specialization and availability status.

### 3.3. Appointment
```java
import java.time.LocalDateTime;

public class Appointment {
    private String appointmentId;
    private String userId;
    private String doctorId;
    private LocalDateTime appointmentDateTime;
    private AppointmentStatus status;
    
    // Constructors, Getters, and Setters
}

public enum AppointmentStatus {
    SCHEDULED,
    COMPLETED,
    CANCELLED,
    REFERRED
}
```

**Explanation:** The Appointment class represents a consultation session scheduled between a patient and a doctor, with attributes like status and scheduled time.

### 3.4. Prescription
```java
import java.time.LocalDateTime;

public class Prescription {
    private String prescriptionId;
    private String appointmentId;
    private String doctorId;
    private String userId;
    private String diagnosis;
    private String medications;
    private LocalDateTime dateIssued;
    
    // Constructors, Getters, and Setters
}
```

**Explanation:** The Prescription class stores details about the medical advice or medications prescribed by a doctor during an appointment.

### 3.5. Chat
```java
import java.time.LocalDateTime;

public class Chat {
    private String chatId;
    private String appointmentId;
    private String senderId;
    private String message;
    private LocalDateTime timestamp;
    
    // Constructors, Getters, and Setters
}
```

**Explanation:** The Chat class facilitates text-based communication between a user and a doctor within the context of an appointment.

### 3.6. VideoSession
```java
import java.time.LocalDateTime;

public class VideoSession {
    private String sessionId;
    private String appointmentId;
    private LocalDateTime startTime;
    private LocalDateTime endTime;
    private VideoSessionStatus status;
    
    // Constructors, Getters, and Setters
}

public enum VideoSessionStatus {
    ONGOING,
    ENDED
}
```

**Explanation:** The VideoSession class represents a video consultation between a patient and a doctor, tracking the session's start and end times.

## 4. Service Layer

### 4.1. UserService
```java
public class UserService {
    
    public User login(String email, String password) {
        // Authenticate user and return user details
    }
    
    public User register(String name, String email, String password, String role) {
        // Register a new user and return the user object
    }
    
    public User getUserById(String userId) {
        // Fetch user details by ID
    }
}
```

**Explanation:** UserService handles user-related operations like login, registration, and profile management.

### 4.2. DoctorService
```java
public class DoctorService {
    
    public Doctor getAvailableDoctor(String specialization) {
        // Find an available doctor with the specified specialization
    }
    
    public void updateDoctorAvailability(String doctorId, boolean isAvailable) {
        // Update the availability status of a doctor
    }
    
    public List<Doctor> getAllDoctors() {
        // Retrieve a list of all doctors
    }
}
```

**Explanation:** DoctorService manages doctor availability and assignment to appointments.

### 4.3. AppointmentService
```java
public class AppointmentService {
    
    public Appointment bookAppointment(String userId, String specialization, LocalDateTime appointmentDateTime) {
        // Book an appointment and assign an available doctor
    }
    
    public void cancelAppointment(String appointmentId) {
        // Cancel an appointment and release the doctor
    }
    
    public Appointment getAppointmentById(String appointmentId) {
        // Fetch appointment details by ID
    }
}
```

**Explanation:** AppointmentService handles the booking, cancellation, and management of appointments, ensuring that a doctor is assigned in real-time.

### 4.4. CommunicationService
```java
public class CommunicationService {
    
    public void sendMessage(String appointmentId, String senderId, String message) {
        // Send a chat message within the context of an appointment
    }
    
    public List<Chat> getChatHistory(String appointmentId) {
        // Retrieve the chat history for an appointment
    }
    
    public VideoSession startVideoSession(String appointmentId) {
        // Start a new video session for an appointment
    }
    
    public void endVideoSession(String sessionId) {
        // End the video session and update its status
    }
}
```

**Explanation:** CommunicationService manages chat and video communication between users and doctors.

### 4.5. PrescriptionService
```java
public class PrescriptionService {
    
    public Prescription generatePrescription(String appointmentId, String diagnosis, String medications) {
        // Create and store a new prescription
    }
    
    public Prescription getPrescriptionByAppointmentId(String appointmentId) {
        // Fetch prescription details by appointment ID
    }
}
```

**Explanation:** PrescriptionService is responsible for generating and retrieving prescriptions based on the consultation.

### 4.6. NotificationService
```java
public class NotificationService {
    
    public void sendNotification(String userId, String message) {
        // Send notifications to users for appointment updates, reminders, etc.
    }
}
```

**Explanation:** NotificationService handles notifications related to appointments, ensuring that users and doctors are informed of changes or reminders.

## 5. Database Schema Design

### 5.1. User Table

|Column        |	Type   |	Description                     |
|--------------|-----------|------------------------------------|
|user_id|	VARCHAR|	Primary key, unique ID for user
|name|	VARCHAR|	User's name
|email|	VARCHAR|	User's email
|password|	VARCHAR|	Hashed password
|role|	ENUM|	Role of the user (Patient, Doctor)
|phone_number|	VARCHAR	|User's phone number

### 5.2. Doctor Table

|Column        |	Type   |	Description                     |
|--------------|-----------|------------------------------------|
doctor_id|	VARCHAR	|Primary key, unique ID for doctor
user_id|	VARCHAR	|Foreign key to user table
specialization	|VARCHAR|	Doctor's specialization
is_available|	BOOLEAN|	Doctor's availability status

### 5.3. Appointment Table

|Column        |	Type   |	Description                     |
|--------------|-----------|------------------------------------|
appointment_id|	VARCHAR|	Primary key, unique ID for appointment
user_id|	VARCHAR|	Foreign key to user table
doctor_id	|VARCHAR|	Foreign key to doctor table
appointment_datetime|	TIMESTAMP|	Date and time of the appointment
status|	ENUM|	Status of the appointment (Scheduled, etc.)

### 5.4. Prescription Table

|Column        |	Type   |	Description                     |
|--------------|-----------|------------------------------------|
|prescription_id|	VARCHAR|	Primary key, unique ID for prescription
|appointment_id|	VARCHAR | Foreign key to appointment table 
| doctor_id | VARCHAR | Foreign key to doctor table 
| user_id  |VARCHAR | Foreign key to user table  
| diagnosis | TEXT | Doctor's diagnosis 
| medications | TEXT | Prescribed medications 
| date_issued | TIMESTAMP | Date and time of prescription issue 

### 5.5. Chat Table

|Column        |	Type   |	Description                     |
|--------------|-----------|------------------------------------|
|chat_id|	VARCHAR	|Primary key, unique ID for chat|
|appointment_id|	VARCHAR	|Foreign key to appointment table|
|sender_id|	VARCHAR|	ID of the sender (user or doctor)|
|message|	TEXT|	Chat message|
|timestamp|	TIMESTAMP|	Time the message was sent|

### 5.6. VideoSession Table

|Column        |	Type   |	Description                     |
|--------------|-----------|------------------------------------|
|session_id|	VARCHAR	|Primary key, unique ID for session
|appointment_id|	VARCHAR	|Foreign key to appointment table
|start_time|	TIMESTAMP|	Start time of the video session
|end_time|	TIMESTAMP	|End time of the video session
|status|	ENUM|	Status of the session (Ongoing, Ended)

## 6. User Flow

1. User Registration and Login:
    * Users register with their details (name, email, password, role).
    * Users log in using email and password.

2. Booking an Appointment:
    * A user selects a specialization and books an appointment.
    * The system assigns an available doctor in real-time.
    * The appointment is confirmed, and notifications are sent to both user and doctor.

3. Consultation:
    * The user and doctor can start a chat or video session at the scheduled time.
    * The doctor diagnoses and generates a prescription if needed.
    * The doctor can close the appointment, refer the user to another doctor, or reschedule.

4. Post-Consultation:
    * The appointment status is updated (Completed, Referred, Cancelled).
    * The doctor becomes available for new appointments.

This design outlines the key components and interactions within the health consultation app, ensuring a seamless user experience from booking to consultation completion.